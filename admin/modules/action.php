<?php/** * Старая версия файлика, нужно переделать под новую модель mvc * И перенести все в контролер content */ include ('../../config.php');if (isset($_GET['moveup'])) {    moveItem($_GET['moveup'], "up");    #header("Location: ../index2.php?id=" . ID_ACTIVE_PAGE . "&lang=" . LANG);    header("Location: ../index2.php?id=" . ID_ACTIVE_PAGE);}if (isset($_GET['movedown'])) {    moveItem($_GET['movedown'], "down");    #header("Location: ../index2.php?id=" . ID_ACTIVE_PAGE . "&lang=" . LANG);    header("Location: ../index2.php?id=" . ID_ACTIVE_PAGE);}if (isset($_POST['subm']) || isset($_POST['submit_form'])) {    /* Чекбоксы: отображать страницу" */    $show = 0;    if ($_POST['show']) {        $show = 1;    }    $db = new mysql();    $arFields = array('page' => stripcslashes($_POST['page']), 'name' =>        stripcslashes($_POST['name']), 'title' => $_POST['title'], 'keywords' => $_POST['keywords'],        'description' => $_POST['description'], 'header' => $_POST['header'], '_link' =>        translit($_POST['link']), '_show' => $show);    $arCond = array('id' => $_POST['id']);    $table = "content_" . $_POST['lang'];    $db->update($table, $arFields, $arCond);    if (isset($_POST['ajax'])) {        echo '1'; // Возвращаем еденичку обратно, говорим, что все прошло ок    } else {        #header("location: ../index2.php?id=" . $_POST['id'] . "&lang=" . LANG);        header("location: ../index2.php?id=" . $_POST['id']);    }}if (isset($_GET['add'])) {    $db = new mysql();    $tmp = $db->select("select max(weight)+1 as newweight from content_" . LANG);    $newweight = $tmp[0]['newweight'];    $ar = array('parent' => $_GET['add'],                 'header' => 'Header page',                 'name' => 'New page',                 'title' => 'Title',                 'description' => 'Description',                 'keywords' => 'Keywords',                 'weight' => $newweight,                 '_show' => '1');        $db->insert('content_' . LANG, $ar);     /*    Добавляем страницу на всех языках    $db->insert('content_ru', $ar);    $db->insert('content_ua', $ar);    $db->insert('content_en', $ar);    */        $last_insert_id = mysql_insert_id();    $ar = array('_link' => $last_insert_id);    $where = array('id' => $last_insert_id);        $db->update('content_' . LANG, $ar, $where);    /*    Обновляем страничку на всех языках        $db->update('content_ru', $ar, $where);    $db->update('content_ua', $ar, $where);    $db->update('content_en', $ar, $where);    */        $arr = $db->select("select max(id) as mx from content_" . LANG);    #header("Location: ../index2.php?id=" . $arr[0]['mx'] . "&lang=" . LANG);    header("Location: ../index2.php?id=" . $arr[0]['mx']);}if (isset($_GET['del'])) {    $db = new mysql();    $ar = array('id' => $_GET['del']);        $db->delete('content_' . LANG, $ar);    /*    Удалить страницу на всех языках    $db->delete('content_ru', $ar);    $db->delete('content_ua', $ar);    $db->delete('content_en', $ar);    header("location: ../index2.php?lang=" . LANG);    */    header("location: ../index2.php");    }function moveItem($id, $direction){    $db = new mysql();    $dir = ($direction == 'down') ? true : false;    $result = $db->select('SELECT weight, parent FROM content_' . LANG .        ' WHERE id=' . $id);    $weight = $result[0]['weight'];    $parent = $result[0]['parent'];    $result = $db->select("SELECT id, weight FROM content_" . LANG . " WHERE weight" .        ($dir ? ">" : "<") . "$weight AND parent=" . $parent . " ORDER BY weight " . ($dir ?        "ASC" : "DESC"));    if ($result) {        $newid = $result[0]['id'];        $newweight = $result[0]['weight'];                $db->update('content_' . LANG, array('weight' => $weight), array('id' => $newid));        $db->update('content_' . LANG, array('weight' => $newweight), array('id' => $id));        /*        Перемещаем элементы меню на трех языках        $db->update('content_ru', array('weight' => $weight), array('id' => $newid));        $db->update('content_ru', array('weight' => $newweight), array('id' => $id));        $db->update('content_ua', array('weight' => $weight), array('id' => $newid));        $db->update('content_ua', array('weight' => $newweight), array('id' => $id));        $db->update('content_en', array('weight' => $weight), array('id' => $newid));        $db->update('content_en', array('weight' => $newweight), array('id' => $id));        */    }}/** * Превод текста с кириллицы в транслит */function translit($str){    //$str = iconv('UTF-8', 'windows-1251', $str);    $tr = array("А" => "A", "Б" => "B", "В" => "V", "Г" => "G", "Д" => "D", "Е" =>        "E", "Ж" => "J", "З" => "Z", "И" => "I", "Й" => "Y", "К" => "K", "Л" => "L", "М" =>        "M", "Н" => "N", "О" => "O", "П" => "P", "Р" => "R", "С" => "S", "Т" => "T", "У" =>        "U", "Ф" => "F", "Х" => "H", "Ц" => "TS", "Ч" => "CH", "Ш" => "SH", "Щ" => "SCH",        "Ъ" => "", "Ы" => "YI", "Ь" => "", "Э" => "E", "Ю" => "YU", "Я" => "YA", "а" =>        "a", "б" => "b", "в" => "v", "г" => "g", "д" => "d", "е" => "e", "ж" => "j", "з" =>        "z", "и" => "i", "й" => "y", "к" => "k", "л" => "l", "м" => "m", "н" => "n", "о" =>        "o", "п" => "p", "р" => "r", "с" => "s", "т" => "t", "у" => "u", "ф" => "f", "х" =>        "h", "ц" => "ts", "ч" => "ch", "ш" => "sh", "щ" => "sch", "ъ" => "y", "ы" =>        "yi", "ь" => "", "э" => "e", "ю" => "yu", "я" => "ya", " " => "");    return strtr($str, $tr);}?>